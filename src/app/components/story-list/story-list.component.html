<!-- Story List Container -->
<div class="story-list-container">
  <!-- Header Section -->
  <div class="header-section">
    <div class="header-content">
      <div class="header-text">
        <h1 class="page-title">Discover Stories</h1>
        <p class="page-subtitle">Choose a story to start your language learning journey</p>
      </div>
      <button class="refresh-header-btn" (click)="refreshStories()" [disabled]="loading">
        <span class="refresh-icon" [class.spinning]="loading">üîÑ</span>
        Refresh
      </button>
    </div>
  </div>

  <!-- Filters Section -->
  <div class="filters-section">
    <div class="filter-row">
      <!-- Search Input -->
      <div class="search-container">
        <input
          type="text"
          class="search-input"
          placeholder="Search stories..."
          [(ngModel)]="searchKeyword"
          (ngModelChange)="onSearchKeywordChange($event)"
        />
        <i class="search-icon">üîç</i>
      </div>

      <!-- Language Filter -->
      <div class="filter-group">
        <label class="filter-label">Language:</label>
        <select
          class="filter-select"
          [(ngModel)]="selectedLanguage"
          (ngModelChange)="onLanguageChange()"
        >
          <option value="">All Languages</option>
          @for (lang of languages; track lang) {
            <option [value]="lang">
              {{ lang.toUpperCase() }}
            </option>
          }
        </select>
      </div>

      <!-- Difficulty Filter -->
      <div class="filter-group">
        <label class="filter-label">Difficulty:</label>
        <select
          class="filter-select"
          [(ngModel)]="selectedDifficulty"
          (ngModelChange)="onDifficultyChange()"
        >
          <option value="">All Levels</option>
          @for (difficulty of difficulties; track difficulty) {
            <option [value]="difficulty">
              {{ storyService.getDifficultyLabel(difficulty) }}
            </option>
          }
        </select>
      </div>

      <!-- Clear Filters Button -->
      <button class="clear-filters-btn" (click)="clearFilters()">
        Clear Filters
      </button>
    </div>

    <!-- Tags Filter -->
    <div class="tags-row">
      <span class="tags-label">Tags:</span>
      <div class="tags-container">
        @for (tag of availableTags; track tag) {
          <button
            class="tag-button"
            [class.selected]="isTagSelected(tag)"
            (click)="onTagToggle(tag)"
          >
            {{ tag }}
          </button>
        }
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  @if (loading) {
    <div class="loading-overlay">
      <div class="loading-content">
        <div class="loading-spinner"></div>
        <h2>üìö {{ stories.length === 0 ? 'Loading stories...' : 'Refreshing stories...' }}</h2>
        <p class="loading-subtitle">Please wait...</p>
      </div>
    </div>
  }

  <!-- Error State -->
  @if (error) {
    <div class="error-container">
      <div class="error-message">
        <i class="error-icon">‚ö†Ô∏è</i>
        <p>{{ error }}</p>
        <div class="error-actions">
          <button class="retry-btn" (click)="retry()">Try Again</button>
          <button class="refresh-btn" (click)="refreshStories()">üîÑ Refresh</button>
        </div>
      </div>
    </div>
  }

  <!-- Stories Grid -->
  @if (!loading || stories.length > 0) {
    <div class="stories-grid">
      @for (story of filteredStories; track story.id) {
        <div class="story-card" (click)="onStoryClick(story)">
      <!-- Story Image/Thumbnail -->
      <div class="story-image">
        <div class="difficulty-badge" [style.background-color]="getDifficultyColor(story.difficulty)">
          {{ storyService.getDifficultyLabel(story.difficulty) }}
        </div>
        @if (isStoryCompleted(story)) {
          <div class="completed-badge">
            ‚úì Completed
          </div>
        }
      </div>

      <!-- Story Content -->
      <div class="story-content">
        <h3 class="story-title">{{ story.title }}</h3>
        
        <p class="story-description">
          {{ story.content | slice:0:100 }}{{ story.content.length > 100 ? '...' : '' }}
        </p>

        <!-- Story Metadata -->
        <div class="story-metadata">
          <div class="metadata-item">
            <i class="icon">üåê</i>
            <span>{{ story.language.toUpperCase() }}</span>
          </div>
          
          @if (story.estimatedDuration) {
            <div class="metadata-item">
              <i class="icon">‚è±Ô∏è</i>
              <span>{{ formatDuration(story.estimatedDuration) }}</span>
            </div>
          }
          
          @if (story.vocabularyCount) {
            <div class="metadata-item">
              <i class="icon">üìö</i>
              <span>{{ story.vocabularyCount }} words</span>
            </div>
          }
        </div>

        <!-- Story Tags -->
        @if (story.tags.length > 0) {
          <div class="story-tags">
            @for (tag of story.tags; track tag) {
              <span class="story-tag">
                {{ tag }}
              </span>
            }
          </div>
        }

        <!-- Progress Bar (if story is started) -->
        @if (isStoryStarted(story)) {
          <div class="progress-container">
          <div class="progress-bar">
            <div
              class="progress-fill"
              [style.width.%]="getStoryProgress(story)"
            ></div>
            </div>
            <span class="progress-text">{{ getStoryProgress(story) }}% complete</span>
          </div>
        }
      </div>

        <!-- Story Actions -->
        <div class="story-actions">
          @if (!isStoryStarted(story)) {
            <button class="start-btn" (click)="onStartStory(story, $event)">
              Start Reading
            </button>
          }
          
          @if (isStoryStarted(story) && !isStoryCompleted(story)) {
            <button class="continue-btn" (click)="onStartStory(story, $event)">
              Continue
            </button>
          }
          
          @if (isStoryCompleted(story)) {
            <button class="review-btn" (click)="onStartStory(story, $event)">
              Review
            </button>
          }
        </div>
        </div>
      }
    </div>
  }

  <!-- Load More Button -->
  @if (stories.length > 0 && !loading) {
    <div class="load-more-container">
      <button class="load-more-btn" (click)="loadMore()">
        Load More Stories
      </button>
    </div>
  }

  <!-- Loading More Indicator -->
  @if (loading && stories.length > 0) {
    <div class="loading-more">
      <div class="loading-spinner small"></div>
      <span>Loading more stories...</span>
    </div>
  }

  <!-- Empty State -->
  @if (!loading && stories.length === 0 && !error) {
    <div class="empty-state">
      <div class="empty-icon">üìö</div>
      <h3>No stories found</h3>
      <p>Try adjusting your filters or search terms</p>
      <button class="clear-filters-btn" (click)="clearFilters()">
        Clear All Filters
      </button>
    </div>
  }
</div>
